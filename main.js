!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(e){this._popup=e,this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup__close")||e.target.classList.contains("popup_opened"))&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._popupForm=this._popup.querySelector(".form"),this._handleFormSubmit=t,this._inputs=this._popupForm.querySelectorAll(".popup__input")}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){this._popupForm.reset(),super.close()}}const n=document.querySelector("#editProfileForm"),i=document.querySelector("#addCardForm"),r=document.querySelector(".elements"),o=document.querySelector(".profile__name"),l=document.querySelector(".profile__occupation"),a=document.querySelector("#popup__edit"),u=document.querySelector("#popup__add"),c=document.querySelector("#popup__pic"),_=document.querySelector("#name"),d=document.querySelector("#occupation"),p=document.querySelector(".profile__edit"),h=document.querySelector(".profile__add"),m={},E=t=>{const s=function(t){const s=new class{constructor(t,s,n){e(this,"_handleLikeButton",(()=>{this._likeBtn.classList.toggle("element__like-active")})),e(this,"_handleDeleteButton",(()=>{this._element.remove(),this._element=null})),this._name=t.name,this._link=t.link,this._handleCardClick=s,this._cardSelector=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._cardImage.addEventListener("click",this._handleCardClick),this._likeBtn.addEventListener("click",this._handleLikeButton),this._deleteBtn.addEventListener("click",this._handleDeleteButton)}generateCard(){return this._element=this._getTemplate(),this._likeBtn=this._element.querySelector(".element__like"),this._cardImage=this._element.querySelector(".element__image"),this._deleteBtn=this._element.querySelector(".element__delete"),this._text=this._element.querySelector(".element__name"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._text.textContent=this._name,this._setEventListeners(),this._element}}(t,(()=>{b.open(t)}),"#newCardTemplate");return s.generateCard()}(t);v.addItem(s)},v=new class{constructor(e,t){let{items:s,renderer:n}=e;this._items=s,this._renderer=n,this._container=t}renderer(){this._items.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({items:[{name:"Yosemite Valley",link:"https://code.s3.yandex.net/web-code/yosemite.jpg"},{name:"Lake Louise",link:"https://code.s3.yandex.net/web-code/lake-louise.jpg"},{name:"Bald Mountains",link:"https://code.s3.yandex.net/web-code/bald-mountains.jpg"},{name:"Latemar",link:"https://code.s3.yandex.net/web-code/latemar.jpg"},{name:"Vanoise National Park",link:"https://code.s3.yandex.net/web-code/vanoise.jpg"},{name:"Lago di Braies",link:"https://code.s3.yandex.net/web-code/lago.jpg"}],renderer:E},r);v.renderer();const y=new class{constructor(e){let{userName:t,userJob:s}=e;this._userName=t,this._userJob=s}getUserInfo(){return{userName:this._userName.textContent,userJob:this._userJob.textContent}}setUserInfo(e){this._userName.textContent=e.name,this._userJob.textContent=e.about}}({userName:o,userJob:l}),b=new class extends t{constructor(e){super(e),this._caption=this._popup.querySelector(".popup__image-name"),this._img=this._popup.querySelector(".popup__image-picture")}open(e){let{link:t,name:s}=e;this._caption.textContent=s,this._img.src=t,this._img.alt=s,super.open()}}(c),g=new s(a,(e=>{y.setUserInfo(e),g.close()})),S=new s(u,(e=>{E({name:e.title,link:e.imageUrl}),S.close()}));var L;g.setEventListeners(),S.setEventListeners(),b.setEventListeners(),p.addEventListener("click",(function(){g.open();const e=y.getUserInfo();_.value=e.userName,d.value=e.userJob,m[n.getAttribute("id")].resetValidation()})),h.addEventListener("click",(function(){S.open(),m[i.getAttribute("id")].resetValidation()})),L={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input-error",errorClass:"input-error_visible"},Array.from(document.querySelectorAll(".form")).forEach((e=>{const t=new class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_showInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}_setEventListeners(){this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleButtonState(),this._checkInputValidity(e)}))}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}(L,e),s=e.getAttribute("id");m[s]=t,t.enableValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFVBQVcsSUFFL0JwSSxLQUFLbUksZUFBZTlILFVBQVVLLE9BQU9WLEtBQUtrSCxzQkFDMUNsSCxLQUFLbUksZUFBZUMsVUFBVyxHQUluQ3JFLHFCQUNFL0QsS0FBS2dJLFdBQWFwQixNQUFNQyxLQUN0QjdHLEtBQUtxSCxhQUFhN0YsaUJBQWlCeEIsS0FBS2dILGlCQUUxQ2hILEtBQUttSSxlQUFpQm5JLEtBQUtxSCxhQUFhaEcsY0FDdENyQixLQUFLaUgsdUJBRVBqSCxLQUFLa0kscUJBQ0xsSSxLQUFLZ0ksV0FBV3JHLFNBQVNDLElBQ3ZCQSxFQUFNcEIsaUJBQWlCLFNBQVMsS0FDOUJSLEtBQUtrSSxxQkFDTGxJLEtBQUs0SCxvQkFBb0JoRyxTQUsvQnlFLGtCQUNFckcsS0FBS2tJLHFCQUNMbEksS0FBS2dJLFdBQVdyRyxTQUFTNEYsSUFDdkJ2SCxLQUFLMkgsZ0JBQWdCSixNQUl6QmMsbUJBQ0VySSxLQUFLcUgsYUFBYTdHLGlCQUFpQixVQUFXSSxJQUM1Q0EsRUFBSW1CLG9CQUVOL0IsS0FBSytELHVCTGU2Qm1DLEVBQVVZLEdBQ3hDd0IsRUFBV3hCLEVBQVlWLGFBQWEsTUFDMUN2RCxFQUFleUYsR0FBWXZCLEVBQzNCQSxFQUFVc0Isc0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9jYXJkcy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IocG9wdXApIHtcclxuICAgICAgdGhpcy5fcG9wdXAgPSBwb3B1cDtcclxuICAgICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgICBcclxuICAgIH1cclxuICBcclxuICAgIG9wZW4oKSB7XHJcbiAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XHJcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgIH1cclxuICBcclxuICAgIGNsb3NlKCkge1xyXG4gICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XHJcbiAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fY2xvc2VcIikgfHxcclxuICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlbmVkXCIpXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwLCBoYW5kbGVGb3JtU3VibWl0KSB7XHJcbiAgICBzdXBlcihwb3B1cCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmZvcm1cIik7XHJcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcclxuICB9XHJcblxyXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcblxyXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX3BvcHVwRm9ybS5yZXNldCgpO1xyXG4gICAgc3VwZXIuY2xvc2UoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gICAge1xyXG4gICAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFrZS1sb3Vpc2UuanBnXCJcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcclxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIlxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIlxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcclxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS92YW5vaXNlLmpwZ1wiXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXHJcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIlxyXG4gICAgfVxyXG4gIF07IiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCB7aW5pdGlhbENhcmRzfSBmcm9tIFwiLi4vdXRpbHMvY2FyZHMuanNcIjtcclxuXHJcbmNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIuZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fc3VibWl0XCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fc3VibWl0X2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dC1lcnJvclwiLFxyXG4gIGVycm9yQ2xhc3M6IFwiaW5wdXQtZXJyb3JfdmlzaWJsZVwiXHJcbn07XHJcblxyXG5cclxuY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXRQcm9maWxlRm9ybVwiKTtcclxuY29uc3QgYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkQ2FyZEZvcm1cIik7XHJcbmNvbnN0IGVsZW1lbnRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNcIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlQWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX29jY3VwYXRpb25cIik7XHJcbmNvbnN0IGVkaXRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXBfX2VkaXRcIik7XHJcbmNvbnN0IGFkZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9fYWRkXCIpO1xyXG5jb25zdCBlbmxhcmdlUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwX19waWNcIik7XHJcbmNvbnN0IHVzZXJJbnB1dE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVcIik7XHJcbmNvbnN0IHVzZXJJbnB1dEFib3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNvY2N1cGF0aW9uXCIpO1xyXG5jb25zdCBvcGVuRWRpdFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0XCIpO1xyXG5jb25zdCBvcGVuQWRkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZFwiKTtcclxuXHJcblxyXG5cclxuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fTtcclxuXHJcbmNvbnN0IHJlbmRlckNhcmQgPSAoY2FyZCkgPT4geyBcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZCk7XHJcbiAgY2FyZExpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbn1cclxuXHJcbmNvbnN0IGNhcmRMaXN0ID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgaXRlbXM6IGluaXRpYWxDYXJkcyxcclxuICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxyXG4gIH0sXHJcbiAgZWxlbWVudHNMaXN0XHJcbik7XHJcblxyXG5jYXJkTGlzdC5yZW5kZXJlcigpO1xyXG5cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIHVzZXJOYW1lOiBwcm9maWxlTmFtZSxcclxuICB1c2VySm9iOiBwcm9maWxlQWJvdXQsXHJcbn0pO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShlbmxhcmdlUG9wdXApO1xyXG5cclxuY29uc3QgdXNlckluZm9Qb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKGVkaXRQb3B1cCwgKGRhdGEpID0+IHtcclxuICB1c2VySW5mby5zZXRVc2VySW5mbyhkYXRhKTtcclxuICB1c2VySW5mb1BvcHVwLmNsb3NlKCk7XHJcbn0pO1xyXG5cclxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oYWRkUG9wdXAsIChkYXRhKSA9PiB7XHJcbiAgcmVuZGVyQ2FyZCh7IFxyXG4gICAgbmFtZTogZGF0YS50aXRsZSwgXHJcbiAgICBsaW5rOiBkYXRhW1wiaW1hZ2VVcmxcIl0sIFxyXG4gIH0pO1xyXG4gIG5ld0NhcmRQb3B1cC5jbG9zZSgpO1xyXG59KTtcclxuXHJcbnVzZXJJbmZvUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxubmV3Q2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVkaXRCdXR0b24oKSB7XHJcbiAgdXNlckluZm9Qb3B1cC5vcGVuKCk7XHJcbiAgY29uc3QgaW5mbyA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgdXNlcklucHV0TmFtZS52YWx1ZSA9IGluZm8udXNlck5hbWU7XHJcbiAgdXNlcklucHV0QWJvdXQudmFsdWUgPSBpbmZvLnVzZXJKb2I7XHJcbiAgZm9ybVZhbGlkYXRvcnNbZWRpdEZvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIildLnJlc2V0VmFsaWRhdGlvbigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBZGRCdXR0b24oKSB7XHJcbiAgbmV3Q2FyZFBvcHVwLm9wZW4oKTtcclxuICBmb3JtVmFsaWRhdG9yc1thZGRGb3JtLmdldEF0dHJpYnV0ZShcImlkXCIpXS5yZXNldFZhbGlkYXRpb24oKTtcclxufVxyXG5cclxub3BlbkVkaXRQb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlRWRpdEJ1dHRvbik7XHJcbm9wZW5BZGRQb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQWRkQnV0dG9uKTtcclxuXHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKHNldHRpbmdzKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZm9ybVwiKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCk7XHJcbiAgICBjb25zdCBmb3JtTmFtZSA9IGZvcm1FbGVtZW50LmdldEF0dHJpYnV0ZShcImlkXCIpO1xyXG4gICAgZm9ybVZhbGlkYXRvcnNbZm9ybU5hbWVdID0gdmFsaWRhdG9yO1xyXG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhKSB7XHJcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgZGF0YSxcclxuICAgICgpID0+IHtcclxuICAgICAgaW1hZ2VQb3B1cC5vcGVuKGRhdGEpO1xyXG4gICAgfSxcclxuICAgIFwiI25ld0NhcmRUZW1wbGF0ZVwiXHJcbiAgKTtcclxuXHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufSIsImNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IoZGF0YSwgaGFuZGxlQ2FyZENsaWNrLCBjYXJkU2VsZWN0b3IpIHtcclxuICAgICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcclxuICAgICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gIFxyXG5cclxuICAgIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRcIilcclxuICAgICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gIFxyXG4gICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgXHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUNhcmRDbGljayk7XHJcbiAgICAgIHRoaXMuX2xpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24pO1xyXG4gICAgICB0aGlzLl9kZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZURlbGV0ZUJ1dHRvbik7XHJcbiAgICB9XHJcbiAgXHJcblxyXG4gICAgX2hhbmRsZUxpa2VCdXR0b24gPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdG4uY2xhc3NMaXN0LnRvZ2dsZShcImVsZW1lbnRfX2xpa2UtYWN0aXZlXCIpO1xyXG4gICAgfTtcclxuICBcclxuXHJcbiAgICBfaGFuZGxlRGVsZXRlQnV0dG9uID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcclxuICAgIH07XHJcbiAgXHJcblxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgdGhpcy5fbGlrZUJ0biA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlXCIpO1xyXG4gICAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgICAgIHRoaXMuX2RlbGV0ZUJ0biA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19kZWxldGVcIik7XHJcbiAgICAgIHRoaXMuX3RleHQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbmFtZVwiKTtcclxuICAgICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9uYW1lO1xyXG4gICAgICB0aGlzLl90ZXh0LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICBcclxuICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG5leHBvcnQgZGVmYXVsdCBDYXJkOyIsIlxyXG4gZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgIH1cclxuICBcclxuICAgIHJlbmRlcmVyKCkge1xyXG4gICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB0aGlzLl9yZW5kZXJlcihpdGVtKSk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBhZGRJdGVtKGl0ZW0pIHtcclxuICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgdXNlck5hbWUsIHVzZXJKb2IgfSkge1xyXG4gICAgICB0aGlzLl91c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgICB0aGlzLl91c2VySm9iID0gdXNlckpvYjtcclxuICAgIH1cclxuICBcclxuICAgIGdldFVzZXJJbmZvKCkge1xyXG4gICAgICByZXR1cm4geyB1c2VyTmFtZTogdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQsIHVzZXJKb2I6IHRoaXMuX3VzZXJKb2IudGV4dENvbnRlbnQgfTtcclxuICAgIH1cclxuICBcclxuICAgIHNldFVzZXJJbmZvKGRhdGEpIHtcclxuICAgICAgdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHRoaXMuX3VzZXJKb2IudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xyXG4gICAgfVxyXG4gIH0iLCJcclxuaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcbiBcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXApIHtcclxuICAgIHN1cGVyKHBvcHVwKTtcclxuICAgIHRoaXMuX2NhcHRpb24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZS1uYW1lXCIpO1xyXG4gICAgdGhpcy5faW1nID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtcGljdHVyZVwiKTtcclxuICB9XHJcbiAgb3Blbih7IGxpbmssIG5hbWUgfSkge1xyXG4gICAgdGhpcy5fY2FwdGlvbi50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9pbWcuc3JjID0gbGluaztcclxuICAgIHRoaXMuX2ltZy5hbHQgPSBuYW1lO1xyXG4gICAgc3VwZXIub3BlbigpOyBcclxuICB9XHJcbn0iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCkge1xyXG4gICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XHJcbiAgXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICAgICk7XHJcbiAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICAgICk7XHJcbiAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XHJcbiAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgX2hhc0ludmFsaWRJbnB1dCgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuZXhwb3J0IGRlZmF1bHQgRm9ybVZhbGlkYXRvcjsiXSwibmFtZXMiOlsiUG9wdXAiLCJjb25zdHJ1Y3RvciIsInBvcHVwIiwidGhpcyIsIl9wb3B1cCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwiY2xhc3NMaXN0IiwiYWRkIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiY2xvc2UiLCJyZW1vdmUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0Iiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfcG9wdXBGb3JtIiwicXVlcnlTZWxlY3RvciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2lucHV0cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsImZvckVhY2giLCJpbnB1dCIsIm5hbWUiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJlZGl0Rm9ybSIsImFkZEZvcm0iLCJlbGVtZW50c0xpc3QiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVBYm91dCIsImVkaXRQb3B1cCIsImFkZFBvcHVwIiwiZW5sYXJnZVBvcHVwIiwidXNlcklucHV0TmFtZSIsInVzZXJJbnB1dEFib3V0Iiwib3BlbkVkaXRQb3B1cCIsIm9wZW5BZGRQb3B1cCIsImZvcm1WYWxpZGF0b3JzIiwicmVuZGVyQ2FyZCIsImNhcmQiLCJjYXJkRWxlbWVudCIsImRhdGEiLCJoYW5kbGVDYXJkQ2xpY2siLCJjYXJkU2VsZWN0b3IiLCJfbGlrZUJ0biIsInRvZ2dsZSIsIl9lbGVtZW50IiwiX25hbWUiLCJfbGluayIsImxpbmsiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2NhcmRTZWxlY3RvciIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfY2FyZEltYWdlIiwiX2hhbmRsZUxpa2VCdXR0b24iLCJfZGVsZXRlQnRuIiwiX2hhbmRsZURlbGV0ZUJ1dHRvbiIsImdlbmVyYXRlQ2FyZCIsIl90ZXh0Iiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJpbWFnZVBvcHVwIiwiY3JlYXRlQ2FyZCIsImNhcmRMaXN0IiwiYWRkSXRlbSIsImNvbnRhaW5lciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiaXRlbSIsInByZXBlbmQiLCJ1c2VySW5mbyIsInVzZXJOYW1lIiwidXNlckpvYiIsIl91c2VyTmFtZSIsIl91c2VySm9iIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsImFib3V0IiwiX2NhcHRpb24iLCJfaW1nIiwidXNlckluZm9Qb3B1cCIsIm5ld0NhcmRQb3B1cCIsInRpdGxlIiwic2V0dGluZ3MiLCJpbmZvIiwiZ2V0QXR0cmlidXRlIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJBcnJheSIsImZyb20iLCJmb3JtRWxlbWVudCIsInZhbGlkYXRvciIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvckVsZW1lbnQiLCJpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0IiwiX2lucHV0TGlzdCIsInNvbWUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfYnV0dG9uRWxlbWVudCIsImRpc2FibGVkIiwiZW5hYmxlVmFsaWRhdGlvbiIsImZvcm1OYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==